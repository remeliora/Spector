# Основные изменения COMMIT_7

### (28.02.2024)

### В общем из основного:

## 1) Разгрузил метод `pollDevices`.
Теперь в нём нет проверок устройств на параметр _IsEnable_, ведь мы будем получать список устройств уже с этим параметром.
А проверку на наличие файла устройства и его создание я реализовал через интерфейс DAO.

## 2) Реализовал интерфейс `DAO`
Для данного интерфейса теперь реализованы методы для подготовки среды для данных и сохранения этих данных, как для формата JSON, так и для MongoDB.
Как мы и говорили, была проблема, что при вызове методов через `dao.*` возникала ошибка, что Spring не может определить какую реализацию выполнять.
Поэтому сделал сервис для работы с методами интерфейса DAO и теперь можно выполнять оба решения.

## 3) Сделал `Map schedule` для проверки на время прошлого цикла опроса.
Как мы в прошлый раз обговаривали, я сделал Map для каждого устройства, в котором также будет записываться время с прошлого опроса. 
Тем самым проверка будет осуществляться через это Map, а не напрямую через Json-файл, как это было ранее.

## 4) Реализовал интерфейс `TypeCaster` для конвертации к типам данных.
Так как дублирующегося было много (хотя метод, по факту, один), решил сделать реализации интерфейса для каждого типа данных, тем самым сократил код скрипта.

## 5) Реализовал метод для проверки по порогам `applyThresholds`

## 6) Реализовал логику для взаимодействия с MongoDB
Реализовал похожую структуру как для PostgreSQL (репозиторий, сервис и так далее).
Данные теперь сохраняются не только в Json формате, но и базе MongoDB.
Для каждого из устройств создаётся отдельная коллекция, куда сохраняются данные отдельными файлами после каждого опроса.